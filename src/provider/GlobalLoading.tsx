import { loadingAuth } from "@/Redux/slices/globalLoading";
import { RootState } from "@/Redux/store";
import gsap from "gsap";
import DrawSVGPlugin from "gsap/DrawSVGPlugin";
import Router from "next/router";
import React, { ReactNode, useEffect, useRef } from "react";
import { useDispatch, useSelector } from "react-redux";
gsap.registerPlugin(DrawSVGPlugin);
const GlobalLoading = ({ children }: { children: ReactNode }) => {
  const loading = useSelector((state: RootState) => state.loadingAuth.loading);
  const d = useRef<SVGPathElement>(null);
  const v = useRef<SVGPathElement>(null);
  const g = useRef<SVGPathElement>(null);
  const dispatch = useDispatch();

  useEffect(() => {
    const handleStart = () => {
      dispatch(loadingAuth(false)); // Показываем лоадер
    };

    const handleComplete = () => {
      dispatch(loadingAuth(true)); // Скрываем лоадер
    };

    const handleError = () => {
      dispatch(loadingAuth(true)); // Тоже скрываем при ошибке
    };

    Router.events.on("routeChangeStart", handleStart);
    Router.events.on("routeChangeComplete", handleComplete);
    Router.events.on("routeChangeError", handleError);

    return () => {
      Router.events.off("routeChangeStart", handleStart);
      Router.events.off("routeChangeComplete", handleComplete);
      Router.events.off("routeChangeError", handleError);
    };
  }, [dispatch]);
  return (
    <>
      <div
        className={`${
          loading
            ? "pointer-events-none invisible opacity-0"
            : "pointer-events-auto visible opacity-100"
        }   bg-white z-60   items-center  justify-center w-full h-screen fixed flex `}
      >
        dawd
        <svg
          width="400"
          height="200"
          viewBox="0 0 40 20"
          fill="none"
          strokeWidth={0}
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            ref={d}
            d="M5.12399 9.696C3.78799 9.76 2.82799 9.428 2.24399 8.7C1.53999 9.244 1.02399 9.516 0.695993 9.516C0.519993 9.516 0.387993 9.428 0.299993 9.252C0.219993 9.084 0.179993 8.9 0.179993 8.7C0.179993 8.316 0.327993 7.764 0.623993 7.044C0.975993 6.228 1.29999 5.82 1.59599 5.82C1.74799 5.82 1.86399 6.06 1.94399 6.54C2.07999 7.26 2.20399 7.756 2.31599 8.028C2.57999 7.748 2.90799 7.368 3.29999 6.888C3.69999 6.408 4.15999 5.828 4.67999 5.148C5.97599 3.444 6.83599 2.512 7.25999 2.352C7.40399 2.296 7.54799 2.268 7.69199 2.268C7.85199 2.268 7.97999 2.304 8.07599 2.376C8.17999 2.44 8.23199 2.516 8.23199 2.604C8.23199 2.74 8.11599 2.82 7.88399 2.844C7.71599 2.932 7.50799 3.084 7.25999 3.3C7.01999 3.516 6.76399 3.764 6.49199 4.044C6.22799 4.316 5.97999 4.588 5.74799 4.86C5.51599 5.124 5.32799 5.352 5.18399 5.544C4.32799 6.736 3.47199 7.688 2.61599 8.4L2.54399 8.46C2.79999 8.836 3.10799 9.096 3.46799 9.24C3.82799 9.384 4.22799 9.456 4.66799 9.456C5.39599 9.456 6.08799 9.344 6.74399 9.12C7.40799 8.904 8.00399 8.58 8.53199 8.148C9.06799 7.708 9.50799 7.172 9.85199 6.54C10.228 5.852 10.416 5.196 10.416 4.572C10.416 4.148 10.324 3.748 10.14 3.372C9.95599 2.988 9.70799 2.66 9.39599 2.388C9.09199 2.116 8.75199 1.94 8.37599 1.86C7.93599 1.764 7.47599 1.716 6.99599 1.716C5.76399 1.716 4.62799 2 3.58799 2.568C2.49199 3.168 1.94399 3.84 1.94399 4.584C1.94399 4.784 2.00399 4.956 2.12399 5.1C2.21999 5.212 2.28799 5.276 2.32799 5.292H2.25599C2.03199 5.252 1.83999 5.14 1.67999 4.956C1.51999 4.772 1.43999 4.568 1.43999 4.344C1.43999 3.928 1.56799 3.548 1.82399 3.204C2.08799 2.852 2.46799 2.532 2.96399 2.244C3.95599 1.676 5.12799 1.392 6.47999 1.392C6.78399 1.392 7.08799 1.408 7.39199 1.44C7.69599 1.472 7.99599 1.52 8.29199 1.584C8.81199 1.696 9.28399 1.908 9.70799 2.22C10.132 2.532 10.472 2.912 10.728 3.36C10.984 3.808 11.112 4.292 11.112 4.812C11.112 5.412 10.936 6.032 10.584 6.672C10.232 7.32 9.77599 7.864 9.21599 8.304C8.66399 8.736 8.03999 9.064 7.34399 9.288C6.64799 9.52 5.90799 9.656 5.12399 9.696ZM0.755993 9.3C1.09999 9.148 1.51599 8.832 2.00399 8.352C1.77199 7.968 1.61999 7.644 1.54799 7.38C1.49999 7.204 1.46399 6.936 1.43999 6.576C0.887993 7.368 0.611993 8.06 0.611993 8.652C0.611993 8.9 0.659993 9.116 0.755993 9.3Z"
            stroke="black"
            strokeWidth={0.4} // теперь будет работать
          />
          <path
            ref={v}
            d="M15.0348 9.85201C14.9948 9.85201 14.9748 9.81201 14.9748 9.73201C14.9748 9.46801 15.1988 8.79601 15.6468 7.71601C15.7828 7.40401 15.9188 7.09201 16.0548 6.78001C16.1908 6.46801 16.3228 6.15601 16.4508 5.84401L17.0028 4.22401C17.0908 3.95201 17.1588 3.72001 17.2068 3.52801C17.2628 3.32801 17.2908 3.16401 17.2908 3.03601C17.2908 2.47601 17.1308 2.05601 16.8108 1.77601C16.4908 1.48801 16.0668 1.34401 15.5388 1.34401C15.0428 1.34401 14.5508 1.45601 14.0628 1.68001C13.5828 1.89601 13.1428 2.19201 12.7428 2.56801C12.3508 2.94401 12.0348 3.36401 11.7948 3.82801C11.4508 4.48401 11.2788 5.08401 11.2788 5.62801C11.2788 6.00401 11.3708 6.34401 11.5548 6.64801C11.7388 6.95201 11.9788 7.16001 12.2748 7.27201C12.4828 7.34401 12.6868 7.38001 12.8868 7.38001C13.1668 7.38001 13.4268 7.32001 13.6668 7.20001C13.9068 7.07201 14.0988 6.89601 14.2428 6.67201C14.3948 6.44801 14.4708 6.19601 14.4708 5.91601C14.4708 5.88401 14.4708 5.85201 14.4708 5.82001C14.4708 5.78001 14.4668 5.74401 14.4588 5.71201C14.4268 5.61601 14.4508 5.56801 14.5308 5.56801C14.6188 5.56801 14.6668 5.63201 14.6748 5.76001C14.6828 5.79201 14.6868 5.82401 14.6868 5.85601C14.6948 5.88801 14.6988 5.92401 14.6988 5.96401C14.6988 6.25201 14.6028 6.52001 14.4108 6.76801C14.2188 7.01601 13.9708 7.22001 13.6668 7.38001C13.3708 7.53201 13.0628 7.60801 12.7428 7.60801C12.4148 7.60801 12.0988 7.52801 11.7948 7.36801C11.1468 7.01601 10.8228 6.40401 10.8228 5.53201C10.8228 4.90801 10.9908 4.30401 11.3268 3.72001C11.6308 3.19201 12.0268 2.73201 12.5148 2.34001C13.0028 1.94801 13.5388 1.64401 14.1228 1.42801C14.7068 1.20401 15.2868 1.09201 15.8628 1.09201C16.2628 1.09201 16.6228 1.15601 16.9428 1.28401C17.2628 1.40401 17.5148 1.59201 17.6988 1.84801C17.8908 2.09601 17.9868 2.41601 17.9868 2.80801C17.9868 3.55201 17.6508 4.66801 16.9788 6.15601C16.2108 7.84401 15.8268 8.79201 15.8268 9.00001C15.8268 9.05601 15.8468 9.07601 15.8868 9.06001C16.0948 8.92401 17.0348 7.85201 18.7068 5.84401C19.5628 4.82001 20.2868 3.99201 20.8788 3.36001C21.4788 2.72001 21.9508 2.27601 22.2948 2.02801C22.5988 1.79601 22.8628 1.60801 23.0868 1.46401C23.3108 1.31201 23.4908 1.19601 23.6268 1.11601C24.1228 0.844008 24.5788 0.708008 24.9948 0.708008C25.1788 0.708008 25.3188 0.728008 25.4148 0.768008C25.5188 0.800008 25.5708 0.896008 25.5708 1.05601C25.5708 1.16001 25.5348 1.21201 25.4628 1.21201C25.4388 1.21201 25.3828 1.19601 25.2948 1.16401C25.2068 1.12401 25.1188 1.10401 25.0308 1.10401C24.6068 1.10401 24.1628 1.22801 23.6988 1.47601C22.7708 1.97201 21.7068 2.86001 20.5068 4.14001C20.1628 4.50801 19.7588 4.96401 19.2948 5.50801C18.8388 6.05201 18.3228 6.68801 17.7468 7.41601C16.8348 8.56801 16.2868 9.19601 16.1028 9.30001C15.7588 9.50001 15.4988 9.64001 15.3228 9.72001C15.1548 9.80801 15.0588 9.85201 15.0348 9.85201Z"
            stroke="black"
            strokeWidth={0.4}
          />
          <path
            ref={g}
            d="M25.4439 10.848C25.3799 10.848 25.3479 10.796 25.3479 10.692C25.3479 10.548 25.4039 10.34 25.5159 10.068C25.6359 9.80401 25.8039 9.47201 26.0199 9.07201L26.8599 7.50001C26.3479 7.94001 25.7159 8.33601 24.9639 8.68801C24.4839 8.92001 23.9759 9.10801 23.4399 9.25201C22.9039 9.39601 22.3879 9.46801 21.8919 9.46801C21.0279 9.46801 20.3559 9.26801 19.8759 8.86801C19.3959 8.46801 19.1559 7.94001 19.1559 7.28401C19.1559 6.06001 19.8959 4.81601 21.3759 3.55201C21.7359 3.24801 22.1439 2.96001 22.5999 2.68801C23.0559 2.41601 23.5359 2.18001 24.0399 1.98001C24.5439 1.77201 25.0479 1.61201 25.5519 1.50001C26.0559 1.38001 26.5319 1.32001 26.9799 1.32001C27.3559 1.32001 27.7079 1.37201 28.0359 1.47601C28.3719 1.58001 28.6439 1.73201 28.8519 1.93201C29.0679 2.12401 29.1759 2.36401 29.1759 2.65201C29.1759 2.89201 29.0959 3.12801 28.9359 3.36001C28.7759 3.59201 28.5679 3.80001 28.3119 3.98401C28.0639 4.16801 27.7919 4.31601 27.4959 4.42801C27.2079 4.54001 26.9279 4.59601 26.6559 4.59601C25.9279 4.59601 25.5559 4.20401 25.5399 3.42001C25.5239 3.02001 25.5919 2.82001 25.7439 2.82001C25.8799 2.82001 25.9319 2.99201 25.8999 3.33601C25.8199 3.99201 26.0959 4.32001 26.7279 4.32001C26.9439 4.32001 27.1759 4.28001 27.4239 4.20001C27.6719 4.12001 27.8999 4.00801 28.1079 3.86401C28.3239 3.72001 28.4999 3.56001 28.6359 3.38401C28.7719 3.20801 28.8399 3.02401 28.8399 2.83201C28.8399 2.59201 28.7519 2.40001 28.5759 2.25601C28.4079 2.10401 28.1879 1.99201 27.9159 1.92001C27.6519 1.84801 27.3679 1.81201 27.0639 1.81201C26.4159 1.81201 25.7639 1.91601 25.1079 2.12401C24.4519 2.32401 23.8199 2.60801 23.2119 2.97601C22.6039 3.33601 22.0519 3.75601 21.5559 4.23601C20.4119 5.35601 19.8399 6.38401 19.8399 7.32001C19.8399 7.88001 20.0479 8.32801 20.4639 8.66401C20.8879 8.99201 21.4399 9.15601 22.1199 9.15601C22.6639 9.15601 23.2199 9.05201 23.7879 8.84401C24.3559 8.63601 24.8959 8.38401 25.4079 8.08801C26.4479 7.50401 27.2279 6.88401 27.7479 6.22801L28.0959 5.71201C27.9919 5.71201 27.7879 5.72401 27.4839 5.74801C27.1879 5.77201 26.7839 5.80401 26.2719 5.84401C25.7359 5.88401 25.3119 5.92401 24.9999 5.96401C24.6959 5.99601 24.5039 6.02001 24.4239 6.03601C24.3279 6.06001 24.2319 6.07201 24.1359 6.07201C23.8719 6.07201 23.7399 6.00801 23.7399 5.88001C23.7399 5.68001 24.0919 5.50401 24.7959 5.35201C25.0439 5.29601 25.4279 5.25601 25.9479 5.23201C26.4679 5.20001 27.1239 5.18401 27.9159 5.18401C29.2439 5.18401 30.1399 5.24001 30.6039 5.35201C30.6759 5.36001 30.7119 5.38001 30.7119 5.41201C30.7119 5.49201 30.4359 5.55601 29.8839 5.60401L29.2959 5.65201C29.0719 5.67601 28.9159 5.68801 28.8279 5.68801C28.0119 6.75201 26.9559 8.40801 25.6599 10.656C25.5879 10.784 25.5159 10.848 25.4439 10.848Z"
            stroke="black"
            strokeWidth={0.4}
          />
        </svg>
      </div>
      {children}
    </>
  );
};

export default GlobalLoading;
